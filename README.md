# RBAC权限管理系统 (Mini-RBAC)

这是一个基于Django + Vue3的RBAC (Role-Based Access Control) 权限管理系统，集成了AI聊天功能。系统采用前后端分离架构，提供完善的用户、角色、权限管理功能。

## 项目概述

- **前端技术栈**：Vue 3 + Element Plus + Vuex + Vue Router + Axios
- **后端技术栈**：Django + Django REST Framework + JWT + SQLite
- **AI聊天功能**：集成OpenAI API的流式对话功能

## RBAC基本原理

RBAC（Role-Based Access Control，基于角色的访问控制）是一种通过角色关联用户和权限的访问控制模型。其核心原理如下：

1. **用户（User）**: 系统的使用者，可以是个人、组织或自动化系统等。
2. **角色（Role）**: 用户在组织中的职责或工作岗位，一个用户可以拥有多个角色。
3. **权限（Permission）**: 对特定资源执行特定操作的能力，在本系统中通过菜单和功能点体现。
4. **会话（Session）**: 用户登录系统时创建，包含用户所有激活角色的权限集合。

RBAC的主要优势：
- **简化权限管理**: 通过分配角色而非直接分配权限，大幅降低权限管理的复杂度。
- **职责分离**: 可以基于职责来设计角色，符合最小权限原则。
- **易于审计**: 通过角色关系可以方便地查看和审计谁拥有什么权限。
- **可扩展性**: 在用户和权限数量增加时，仍然可以保持管理的简洁性。

本系统实现了RBAC模型的核心功能，包括用户-角色分配、角色-权限分配，以及基于这些关联关系的权限验证流程。

## 系统功能

- 用户管理：用户CRUD、密码管理、状态管理
- 角色管理：角色CRUD、角色授权
- 菜单管理：菜单CRUD、树状结构
- 权限控制：基于RBAC模型的访问控制
- AI聊天：与GPT模型的流式对话功能

## 软件架构设计

### 系统架构图

```
+---------------+        +---------------+        +---------------+
|               |        |               |        |               |
|    前端       |<------>|    后端API    |<------>|  OpenAI API   |
|  (Vue 3)      |  HTTP  |  (Django)     |  HTTP  |               |
|               |        |               |        |               |
+---------------+        +---------------+        +---------------+
                                |
                                |
                         +---------------+
                         |               |
                         |   数据库      |
                         |  (SQLite)     |
                         |               |
                         +---------------+
```

### ER图 (实体关系图)

```
+---------------+      +----------------+      +---------------+
|    User       |      |    UserRole    |      |    Role       |
+---------------+      +----------------+      +---------------+
| id            |<---->| user_id        |<---->| id            |
| username      |      | role_id        |      | name          |
| password      |      +----------------+      | status        |
| status        |                              | sort          |
| avatar        |                              | remark        |
| email         |                              | create_time   |
| create_time   |                              | update_time   |
+---------------+                              +---------------+
                                                      |
                                                      |
                                              +----------------+      +---------------+
                                              |   RoleMenu     |      |    Menu       |
                                              +----------------+      +---------------+
                                              | role_id        |<---->| id            |
                                              | menu_id        |      | name          |
                                              +----------------+      | path          |
                                                                     | parent_id     |
                                                                     | type          |
                                                                     | icon          |
                                                                     | component     |
                                                                     | perms         |
                                                                     | sort          |
                                                                     | visible       |
                                                                     +---------------+
+---------------+      
|  ChatMessage  |      
+---------------+      
| id            |      
| user_id       |<----+ (关联到User)
| content       |      
| response      |      
| create_time   |      
+---------------+      
```

### UML类图

```
+------------------+        +------------------+        +------------------+
|     SysUser      |        |     SysRole      |        |     SysMenu      |
+------------------+        +------------------+        +------------------+
| -id: Integer     |        | -id: Integer     |        | -id: Integer     |
| -username: String|        | -name: String    |        | -name: String    |
| -password: String|        | -status: Boolean |        | -path: String    |
| -status: Boolean |        | -sort: Integer   |        | -parent_id: Int  |
| -avatar: String  |        | -remark: String  |        | -type: String    |
| -email: String   |        | -create_time     |        | -icon: String    |
| -create_time     |        | -update_time     |        | -component: Str  |
+------------------+        +------------------+        | -perms: String   |
      ^ |                          ^ |                  | -sort: Integer   |
      | |                          | |                  | -visible: Bool   |
      | |                          | |                  +------------------+
      | |                          | |                          ^ |
      | |                          | |                          | |
      | v                          | v                          | v
+------------------+        +------------------+        
| SysUserRole     |        | SysRoleMenu      |        
+------------------+        +------------------+        
| -user_id: FK     |        | -role_id: FK     |        
| -role_id: FK     |        | -menu_id: FK     |        
+------------------+        +------------------+        
```

### 流程图：用户权限验证流程

```
+-------------+     +-------------+     +----------------+     +--------------+
|  用户登录   |---->| 后端验证    |---->| 生成JWT Token  |---->| 返回用户信息  |
+-------------+     +-------------+     +----------------+     +--------------+
                                                                      |
                                                                      v
+-------------+     +-------------+     +----------------+     +--------------+
| 前端保存    |<----| 保存Token   |<----| 保存菜单权限   |<----| 保存用户角色  |
| 状态        |     | 到Storage   |     | 到Storage      |     | 到Storage     |
+-------------+     +-------------+     +----------------+     +--------------+
       |
       v
+-------------+     +-------------+     +----------------+     +--------------+
| 用户请求    |---->| 前端拦截    |---->| 附加Token到    |---->| 发送请求      |
| 资源        |     | 请求        |     | 请求头         |     |               |
+-------------+     +-------------+     +----------------+     +--------------+
                                                                      |
                                                                      v
+-------------+     +-------------+     +----------------+     +--------------+
| 允许访问    |<----| 验证通过    |<----| 后端验证Token  |<----| 后端接收请求  |
| 资源        |     |             |     | 和权限         |     |               |
+-------------+     +-------------+     +----------------+     +--------------+
```

## 目录结构

项目分为前端和后端两部分：

- **frontend/**: Vue 3前端项目
- **backend/**: Django后端项目

每个部分都有自己的README文件，详细说明了安装、配置和实现思路。

## 如何开始

1. 克隆仓库
2. 按照前端和后端的README分别设置和启动服务
3. 访问前端页面，默认为 http://localhost:8080

详细步骤请参考各自目录中的README文件。
